<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bedtime Story â€” Carousel</title>
<style>
:root{
  --night-1:#091024; --night-2:#0a1a3a; --night-3:#061029;
  --paper:rgba(255,255,255,.06); --ink:#e6ecff; --ink-dim:#c9d4ff;
  --accent:#ffe58f; --accent-soft:rgba(255,229,143,.25);
  --card-border:rgba(255,255,255,.12); --shadow:0 10px 30px rgba(0,0,0,.45);
}
html, body { height:100%; } * { box-sizing:border-box; }
body{
  margin:0; font-family:"Georgia",serif; color:var(--ink);
  background:
    radial-gradient(1200px 800px at 70% -10%, rgba(88,118,255,.15), transparent 70%),
    linear-gradient(180deg, var(--night-2), var(--night-3) 60%, #050a1b 100%),
    linear-gradient(120deg, var(--night-1), var(--night-2));
  overflow-x:hidden;
}
/* Night sky */
#sky{ position:fixed; inset:0; pointer-events:none; z-index:0; }
.star{ position:absolute; width:2px; height:2px; border-radius:50%; background:#fff;
  box-shadow:0 0 6px rgba(255,255,255,.9); opacity:.8; animation:twinkle 6s ease-in-out infinite; }
@keyframes twinkle{ 0%,100%{opacity:.35;transform:scale(.85)} 50%{opacity:1;transform:scale(1)} }
@media (prefers-reduced-motion: reduce){ .star{ animation:none } }
.moon{
  position:fixed; right:6vw; top:6vh; width:120px; height:120px; z-index:1; border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #fff 0 45%, #eef2ff 60%, #cbd5e1 100%);
  box-shadow: 0 0 30px rgba(255,255,255,.25), 0 0 90px rgba(255,255,255,.12);
}
.moon::after{
  content:""; position:absolute; inset:0; border-radius:50%;
  background:
    radial-gradient(12px 12px at 55% 36%, rgba(0,0,0,.14) 0 60%, transparent 61%),
    radial-gradient(10px 10px at 30% 60%, rgba(0,0,0,.12) 0 60%, transparent 61%),
    radial-gradient(8px 8px at 68% 66%, rgba(0,0,0,.10) 0 60%, transparent 61%),
    radial-gradient(6px 6px at 40% 40%, rgba(0,0,0,.10) 0 60%, transparent 61%);
  mix-blend-mode:multiply; opacity:.8;
}
.haze{ position:fixed; inset:auto 0 0 0; height:22vh; z-index:0;
  background:linear-gradient(180deg, transparent, rgba(255,255,255,.06) 45%, rgba(255,255,255,.08) 100%);
  filter: blur(2px);
}
/* Card */
.container{
  position:relative; z-index:2; max-width:960px; background:var(--paper);
  margin:56px auto; padding:28px 24px 34px; border-radius:18px;
  border:1px solid var(--card-border); box-shadow:var(--shadow); backdrop-filter: blur(8px);
}
.header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin:0 8px 12px; }
h1{ margin:0; font-size:1.9rem; font-weight:600; letter-spacing:.3px; color:var(--ink); }
.subtitle{ margin:2px 0 0; font-size:.95rem; color:var(--ink-dim); }

/* Audio */
audio{ display:block; margin:12px auto 8px; width:100%; max-width:720px;
  filter: drop-shadow(0 4px 12px rgba(0,0,0,.25)); accent-color:#ffd369; }

/* Error banner */
#err{
  display:none; margin:8px auto 14px; max-width:720px; padding:10px 12px;
  border-radius:10px; border:1px solid rgba(255,0,0,.35);
  background:rgba(255,0,0,.08); color:#ffd2d2; font-size:.95rem;
}

/* Carousel */
.carousel{ position:relative; margin:12px auto 0; max-width:860px; overflow:hidden;
  border-radius:14px; border:1px solid var(--card-border); }
.track{ display:flex; transition: transform .45s cubic-bezier(.22,.61,.36,1); will-change: transform; }
.slide{ min-width:100%; padding:28px 20px 34px; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:8px;
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); }
.slide h2{ font-size:1.4rem; margin:0; color:var(--ink); }
.slide p{ font-size:1rem; color:var(--ink-dim); margin:4px 0 0; text-align:center; max-width:640px; }

/* Controls */
.controls{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin:10px 0 0; }
.btn{
  appearance:none; border:none; cursor:pointer; padding:10px 14px; border-radius:12px;
  background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
  color:var(--ink); font-size:1rem; box-shadow:0 6px 16px rgba(0,0,0,.25);
}
.btn:disabled{ opacity:.5; cursor:not-allowed; }
.dots{ display:flex; gap:8px; align-items:center; justify-content:center; flex:1; }
.dot{
  width:12px; height:12px; border-radius:50%; border:1px solid var(--card-border);
  background:rgba(255,255,255,.12); cursor:pointer;
}
.dot[aria-selected="true"]{ background:var(--accent); box-shadow:0 0 10px var(--accent); }
.footer{ margin-top:12px; text-align:center; font-size:.9rem; color:var(--ink-dim); }
</style>
</head>
<body>
<div id="sky" aria-hidden="true"></div>
<div class="moon" aria-hidden="true"></div>
<div class="haze" aria-hidden="true"></div>

<div class="container" id="reader" role="region" aria-label="Bedtime story reader">
  <div class="header">
    <div>
      <h1 id="titleText">ðŸŒ™ Part 1 â€” The Moonlit Path ðŸŒ™</h1>
      <p class="subtitle" id="subtitleText">Press play and relax.</p>
    </div>
  </div>

  <audio id="audio" controls preload="metadata" playsinline></audio>
  <div id="err" role="alert"></div>

  <div class="carousel" id="carousel" aria-roledescription="carousel">
    <div class="track" id="track" role="group" aria-label="Story parts"></div>
  </div>

  <div class="controls">
    <button class="btn" id="prevBtn" aria-label="Previous part">âŸ¨ Prev</button>
    <div class="dots" id="dots" role="tablist" aria-label="Select part"></div>
    <button class="btn" id="nextBtn" aria-label="Next part">Next âŸ©</button>
  </div>

  <div class="footer">Tip: switching parts updates the title and loads the matching audio.</div>
</div>

<script>
/* â€”â€”â€” Config â€”â€”â€” */
const AUDIO_BASE = "Stories/"; // change to "audio/" if your mp3s are in ./audio/
const PARTS = [
  { title: "ðŸŒ™ Part 1 â€” The First Look",  file: "part1.mp3", blurb: "An unexpected thief" },
  { title: "âœ¨ Part 2 â€” The Gem and the Mermaid",  file: "part2.mp3", blurb: "The gem only for the heart" },
  { title: "ðŸ¦‰ Part 3 â€” The Ship and the Gnome ", file: "part3.mp3", blurb: "The ship that never sinks" },
  { title: "ðŸŒŒ Part 4 â€” The spiders and the dress",    file: "part4.mp3", blurb: "The art you never expect" },
  { title: "ðŸ’¤ Part 5 â€” The ending of the tale the start of a life",      file: "part5.mp3", blurb: "Love never dies" },
];

/* Stars */
(function makeStars(){
  const sky = document.getElementById('sky');
  const STAR_COUNT = 140;
  for(let i=0;i<STAR_COUNT;i++){
    const s = document.createElement('span');
    s.className = 'star';
    s.style.left = (Math.random()*100).toFixed(2) + 'vw';
    s.style.top  = (Math.random()*100).toFixed(2) + 'vh';
    const scale  = (Math.random()*0.9 + 0.2).toFixed(2);
    const delay  = (Math.random()*6).toFixed(2);
    s.style.transform = `scale(${scale})`;
    s.style.animationDelay = `${delay}s`;
    s.style.opacity = (Math.random()*0.6 + 0.25).toFixed(2);
    sky.appendChild(s);
  }
})();

/* Elements */
const track = document.getElementById('track');
const dots  = document.getElementById('dots');
const audio = document.getElementById('audio');
const errEl = document.getElementById('err');
const titleEl = document.getElementById('titleText');
const subtitleEl = document.getElementById('subtitleText');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');

let index = 0;

/* Build slides/dots */
PARTS.forEach((p, i)=>{
  const slide = document.createElement('section');
  slide.className = 'slide';
  slide.setAttribute('aria-roledescription','slide');
  slide.setAttribute('aria-label', `Part ${i+1}`);
  slide.innerHTML = `<h2>${p.title}</h2><p>${p.blurb}</p>`;
  track.appendChild(slide);

  const dot = document.createElement('button');
  dot.className = 'dot';
  dot.setAttribute('role','tab');
  dot.setAttribute('aria-label', `Go to ${p.title}`);
  dot.addEventListener('click', ()=> goTo(i, true));
  dots.appendChild(dot);
});

/* Error helpers */
function showError(msg){
  errEl.style.display = 'block';
  errEl.textContent = msg;
}
function clearError(){
  errEl.style.display = 'none';
  errEl.textContent = '';
}

/* Load a partâ€™s audio */
function loadAudioFor(part){
  clearError();

  // set both src and <source> for explicit mime
  audio.pause();
  audio.currentTime = 0;
  audio.removeAttribute('src');
  while (audio.firstChild) audio.removeChild(audio.firstChild);

  const full = AUDIO_BASE + part.file;
  const source = document.createElement('source');
  source.src = full;
  source.type = 'audio/mpeg';
  audio.appendChild(source);
  audio.load();
}

/* Navigation */
function goTo(i, fromClick=false){
  const wasPlaying = !audio.paused && !audio.ended;
  index = Math.max(0, Math.min(PARTS.length-1, i));
  track.style.transform = `translateX(${-index*100}%)`;

  Array.from(dots.children).forEach((d, di)=> d.setAttribute('aria-selected', di===index ? 'true':'false'));

  const part = PARTS[index];
  titleEl.textContent = part.title;
  subtitleEl.textContent = "Press play and relax.";
  loadAudioFor(part);

  prevBtn.disabled = (index===0);
  nextBtn.disabled = (index===PARTS.length-1);

  // attempt to play after user gesture
  if (fromClick || wasPlaying) {
    audio.play().catch(()=> {
      // Autoplay likely blocked; user can press play
    });
  }
}

/* Buttons */
prevBtn.addEventListener('click', ()=> goTo(index-1, true));
nextBtn.addEventListener('click', ()=> goTo(index+1, true));

/* Keyboard */
document.addEventListener('keydown', (e)=>{
  if (e.key === 'ArrowLeft') goTo(index-1, true);
  if (e.key === 'ArrowRight') goTo(index+1, true);
});

/* Swipe */
let startX=null;
track.addEventListener('touchstart', e=>{ startX = e.touches[0].clientX; }, {passive:true});
track.addEventListener('touchmove',  e=>{
  if (startX===null) return;
  const dx = e.touches[0].clientX - startX;
  if (Math.abs(dx) > 40){
    goTo(index + (dx<0?1:-1), true);
    startX = null;
  }
}, {passive:true});
track.addEventListener('touchend', ()=>{ startX=null; });

/* Audio error diagnostics */
audio.addEventListener('error', ()=>{
  const err = audio.error;
  let msg = "Audio failed to load.";
  if (err){
    const map = {
      1: "Fetching process aborted.",
      2: "Network error while fetching the file.",
      3: "Decoding error (file is corrupted or unsupported).",
      4: "Source not supported (wrong path or format).",
    };
    msg += ` ${map[err.code] || ""} (code ${err.code}).`;
  }
  msg += " Check the filename, path, and that the file is a playable MP3.";
  showError(msg);
});
audio.addEventListener('stalled', ()=> showError("Audio loading stalled. If opened as file://, try a local server."));
audio.addEventListener('canplay', clearError);

/* Init */
goTo(0);

/* Optional: quick environment nudge */
if (!audio.canPlayType || !audio.canPlayType('audio/mpeg')){
  showError("This browser might not support MP3 playback. Try another browser or convert the file.");
}
</script>
</body>
</html>
